2018 Releases
=============

v3.46 - 23 February 2018
------------------------

This release contains a few foundational features have been added
(external objects, Docker connector, credential sharing) that will
improve cloud resource management in the future.  It also includes
changes to the way machines within a deployment access the server and
how deployment reports are stored.  Both require administrator
attention during upgrades. (See migration section.)  The release also
contains a number of bug fixes.

For Everyone:
 - User resource implementation was changed to allow credential
   sharing between users and groups with ACLs.
 - The login dialog was changed to avoid it being obscured on mobile
   devices. 
 - The default ACL for Connector resources was changed to allow all
   authentication users to see them.
 - The bootstrap script has been corrected to avoid an issue where
   machine deployments on Ubuntu 16 machines would fail.
 - The prototype for the new web browser UI has been improved to
   provide better editing capabilities with forms and JSON, to plot
   server metrics, and to render ``href`` attributes as links to other
   resources. 
 - Styles of cubic (new web browser UI) have been normalized to
   provide a consistent look and feel.

For Clara:
 - The login methods of the Python API have been improved to cache
   credentials to make managing access easier.
 - Improved the CIMI support in the Python API to allow CIMI actions
   to be called.
 - The Python API is now part of the SlipStream RPM packages.
 - A utility method was added to the Python API to retrieve deployment
   events.
 - A function was added to the Clojure(Script) API to allow the server
   metrics to be retrieved.
 - A prototype "cloud" connector (alpha) for Docker infrastructures is
   now available.
   
For Dave:
 - The "machine" cookies that were used by VMs within a deployment to
   interact with SlipStream have been replaced by an API key/secret
   pair. These can be revoked if necessary.
 - An "external object" CIMI resource has been created to allow links
   to external files and resources, such as report, data files,
   etc. Reports are now handled with these resources.  (See migration
   below.) 
 - The server organization has been more finely segmented to allow for
   wider reuse of the servers and to make containerization easier.
 - Package dependencies have be rationalized and corrected (including
   the ``cheshire.jar`` verson in the pricing service). More work on
   this will occur in the future to reduce the servers' footprints.
 - SlipStream package dependency on ``slipstream-client-clojure`` (no
   longer created) has been removed.


Alice, Bob, Clara, and Dave can be found
`here <http://sixsq.com/personae/>`_.

Migration
~~~~~~~~~

API key/secret pairs are now being used to manage access to the server
from deployed machines.  For non-scalable deployments, this change
will have no effect.  However, scalable deployments will lose access
to the server. They need to be terminated and restarted.

Below is the migration procedure to enable the view of the connector instances
by users of your SlipStream instance. From now on this is required for the
deployments to succeed.

 - login to SlipStream instance as super user
 - go to \https://\<slipstream\>/webui/cimi/connector
 - click on `magnifying glass` pictogram (this will fetch all connector config instances)
 - click on a connector name link
 - click on `update` button
 - in the edit window add the following into the list under `"acl" -> "rules"`::

   { "principal": "USER", "right": "VIEW", "type": "ROLE" }

 - click on `update` button to persist the configuration
 - repeat this for each connector.

The method of storing reports has changed with this release.  They are
now stored in S3 rather than on the server's disk. This requires that
the administrator have access to an S3 instance and migration of the
existing reports to S3.

You must provide an S3 configuration file
``/opt/slipstream/server/.aws/credentials`` with the following
contents::

  aws_secret_access_key=<KEY>
  aws_access_key_id=<SECRET>
  aws_endpoint=<S3ENDPOINT>

Note that the name of the bucket is not configurable.  It is set to
"slipstream-reports" and must be created before being used.


Known issues
~~~~~~~~~~~~

 - The switch to using API key/secret pairs will only have an effect
   on running scalable deployments. These will need to be stopped and
   redeployed.


Commits
~~~~~~~

 -  `SlipStream <https://github.com/slipstream/SlipStream/compare/v3.45...v3.46>`__
 -  `Server <https://github.com/slipstream/SlipStreamServer/compare/v3.45...v3.46>`__
 -  `UI <https://github.com/slipstream/SlipStreamUI/compare/v3.45...v3.46>`__
 -  `Connectors <https://github.com/slipstream/SlipStreamConnectors/compare/v3.45...v3.46>`__
 -  `Client <https://github.com/slipstream/SlipStreamClient/compare/v3.45...v3.46>`__
 -  `SlipStreamClojureAPI <https://github.com/slipstream/SlipStreamClojureAPI/compare/v3.45...v3.46>`__
 -  `SlipStreamPythonAPI <https://github.com/slipstream/SlipStreamPythonAPI/compare/v3.45...v3.46>`__
 -  `SlipStreamJobEngine <https://github.com/slipstream/SlipStreamJobEngine/compare/v3.45...v3.46>`__


v3.45 - 4 February 2018
-----------------------

This is primarily a bug fix release, but also includes a prototype for
a new web interface.  Feedback on that prototype is welcome. 

For Everyone:
 - An SSH configuration bug that blocked SSH logins on machines
   without pre-existing ``.ssh`` directories was fixed.
 - A bug with the Exoscale connector that caused deployments to fail
   was corrected.
 - A prototype user interface has been included in the release, which
   is available by default on the ``/webui`` relative URL.

For Dave:
 - The configuration for the Job Engine has been added to the quick
   installation script.
 - CIMI resources for NuvlaBox registrations have been added.
 - Unnecessary dependencies have been removed from services and
   packages have been cleaned up.

Alice, Bob, Clara, and Dave can be found
`here <http://sixsq.com/personae/>`_.

Migration
~~~~~~~~~

No migration is necessary.

Known issues
~~~~~~~~~~~~

 - When upgrading rename the ``/etc/default/ssclj`` file to
   ``/etc/default/cimi`` if you've made changes to the configuration
   file.
 - If you've made changes to the nginx configuration files, you will
   need to remove the reference to ``authn.block`` in
   ``/etc/nginx/conf.d/slipstream.params``.
 - The wrong version of ``cheshire.jar`` was included in the RPM
   package for the ``ss-pricing`` service.  Replace
   ``/opt/slipstream/ss-pricing/lib/cheshire.jar`` with version 5.8.0
   that can be found at ``clojars.org``.
 - The RPM package ``slipstream-client-clojure`` was not generated for
   this release. The v3.44 version works fine. 

Commits
~~~~~~~

 -  `SlipStream <https://github.com/slipstream/SlipStream/compare/v3.44...v3.45>`__
 -  `Server <https://github.com/slipstream/SlipStreamServer/compare/v3.44...v3.45>`__
 -  `UI <https://github.com/slipstream/SlipStreamUI/compare/v3.44...v3.45>`__
 -  `Connectors <https://github.com/slipstream/SlipStreamConnectors/compare/v3.44...v3.45>`__
 -  `Client <https://github.com/slipstream/SlipStreamClient/compare/v3.44...v3.45>`__
 -  `SlipStreamClojureAPI <https://github.com/slipstream/SlipStreamClojureAPI/compare/v3.44...v3.45>`__
 -  `SlipStreamPythonAPI <https://github.com/slipstream/SlipStreamPythonAPI/compare/v3.44...v3.45>`__
 -  `SlipStreamJobEngine <https://github.com/slipstream/SlipStreamJobEngine/compare/v3.44...v3.45>`__


v3.44 - 24 January 2018
-----------------------

This is primarily a bug fix release that makes improvements for
SlipStream administrators.

For Everyone:
 - Fix bug in the deployment garbage collection that caused the clean
   up to fail.

For Dave:
 - Extend OpenNebula and NuvlaBox connectors to allow the vCPU/CPU
   ratio to be defined.  The default value is 0.5.
 - Correct Logstash and Filebeat configurations when using the
   installation script to avoid having Logstash logs fill with
   errors. 

Alice, Bob, Clara, and Dave can be found
`here <http://sixsq.com/personae/>`_.

Migration
~~~~~~~~~

No migration is necessary.

Known issues
~~~~~~~~~~~~

No known issues.

Commits
~~~~~~~

 -  `SlipStream <https://github.com/slipstream/SlipStream/compare/v3.43...v3.44>`__
 -  `Server <https://github.com/slipstream/SlipStreamServer/compare/v3.43...v3.44>`__
 -  `UI <https://github.com/slipstream/SlipStreamUI/compare/v3.43...v3.44>`__
 -  `Connectors <https://github.com/slipstream/SlipStreamConnectors/compare/v3.43...v3.44>`__
 -  `Client <https://github.com/slipstream/SlipStreamClient/compare/v3.43...v3.44>`__
 -  `SlipStreamClojureAPI <https://github.com/slipstream/SlipStreamClojureAPI/compare/v3.43...v3.44>`__
 -  `SlipStreamPythonAPI <https://github.com/slipstream/SlipStreamPythonAPI/compare/v3.43...v3.44>`__
 -  `SlipStreamJobEngine <https://github.com/slipstream/SlipStreamJobEngine/compare/v3.43...v3.44>`__


v3.43 - 22 January 2018
-----------------------

For Everyone:
 - Remove deprecated basic authentication and related parameters from
   the Python API and Command Line Client.
 - Fix concurrency issue with cookie handling in the Python API and
   Command Line Client.

For Dave:
 - Mark ``/etc/default/slipstream`` as a configuration file to avoid
   having the configuration overwritten on upgrades.
 - Improve template handling for the Exoscale connector so that the
   most recent templates are used by default.  Avoids a problem with
   running in the DK region.
 - Rationalize and reduce the default logging of the services to allow
   for better discovery and debugging of problems.
 - Optimize the loading of the user resources from the database and
   provide metrics.
 - Minimize connections requests from connectors on initialization.
 - Refactor the deployment garbage collector to reduce object creation
   and database churn.

Alice, Bob, Clara, and Dave can be found
`here <http://sixsq.com/personae/>`_.

Migration
~~~~~~~~~

No migration is necessary.

Known issues
~~~~~~~~~~~~

 - Missing dependency for the ssclj server blocks start of service.

Commits
~~~~~~~

 -  `SlipStream <https://github.com/slipstream/SlipStream/compare/v3.42...v3.43>`__
 -  `Server <https://github.com/slipstream/SlipStreamServer/compare/v3.42...v3.43>`__
 -  `UI <https://github.com/slipstream/SlipStreamUI/compare/v3.42...v3.43>`__
 -  `Connectors <https://github.com/slipstream/SlipStreamConnectors/compare/v3.42...v3.43>`__
 -  `Client <https://github.com/slipstream/SlipStreamClient/compare/v3.42...v3.43>`__
 -  `SlipStreamClojureAPI <https://github.com/slipstream/SlipStreamClojureAPI/compare/v3.42...v3.43>`__
 -  `SlipStreamPythonAPI <https://github.com/slipstream/SlipStreamPythonAPI/compare/v3.42...v3.43>`__
 -  `SlipStreamJobEngine <https://github.com/slipstream/SlipStreamJobEngine/compare/v3.42...v3.43>`__


v3.42 - 12 January 2018
-----------------------

This release brings the following changes.

The persistence of the user entities was moved from HSQLDB to Elasticsearch and
from now on will be managed through CIMI server.  On already deployed systems
this assumes that a migration is required.  Check *Migration* section below.

The following connectors were removed and are no longer supported

* StratusLab
* Azure
* NativeSoftlayer
* VCloud

Fixes and improvements:

* fixed and improved VMs information collection service.

Migration
~~~~~~~~~

The steps below perform migration of users from HSQLDB to Elasticsearch (via
CIMI server).

Download migration script::
   
   $ wget https://raw.githubusercontent.com/slipstream/SlipStreamServer/master/rpm/src/main/migrations/020_migrate_users_to_cimi.py
   $ chmod +x 020_migrate_users_to_cimi.py
   $ yum install python-lxml
   $ # or
   $ pip install lxml

Dump users with::

   $ export SLIPSTREAM_USERNAME=super
   $ export SLIPSTREAM_PASSWORD=<password>
   $ ss-login --endpoint https://<slipstream>
   $ ./020_migrate_users_to_cimi.py --endpoint https://<slipstream> --get users-3.41/

Perform the upgrade::

   $ yum upgrade -y
   $ systemctl restart hsqldb ss-pricing ssclj slipstream \
        slipstream-job-distributor@vms_collect \
        slipstream-job-distributor@vms_cleanup \
        slipstream-job-distributor@jobs_cleanup \
        slipstream-job-executor \
        elasticsearch logstash filebeat kibana


In *https://<slipstream>/configuration -> SlipStream Basics -> java class
names* remove any instances of the following connectors: nativesoftlayer,
stratuslab, stratuslabiter, azure, vcloud. Save the configuration.

Push users back to SlipStream::

   $ ./020_migrate_users_to_cimi.py --endpoint https://<slipstream> --put users-3.41/

Known issues
~~~~~~~~~~~~

 - No known issues.

Commits
~~~~~~~

 -  `SlipStream <https://github.com/slipstream/SlipStream/compare/v3.41...v3.42>`__
 -  `Server <https://github.com/slipstream/SlipStreamServer/compare/v3.41...v3.42>`__
 -  `UI <https://github.com/slipstream/SlipStreamUI/compare/v3.41...v3.42>`__
 -  `Connectors <https://github.com/slipstream/SlipStreamConnectors/compare/v3.41...v3.42>`__
 -  `Client <https://github.com/slipstream/SlipStreamClient/compare/v3.41...v3.42>`__
 -  `SlipStreamClojureAPI <https://github.com/slipstream/SlipStreamClojureAPI/compare/v3.41...v3.42>`__
 -  `SlipStreamPythonAPI <https://github.com/slipstream/SlipStreamPythonAPI/compare/v3.41...v3.42>`__
 -  `SlipStreamJobEngine <https://github.com/slipstream/SlipStreamJobEngine/compare/v3.41...v3.42>`__
